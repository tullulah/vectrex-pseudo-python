META TITLE = "INLINE MALBAN TEST"
META COPYRIGHT = "g GCE 1982"

def main():
    let dummy = 0

def loop():
    SET_INTENSITY(127)
    asm("LDA #127")
    asm("JSR Intensity_a")
    asm("CLR VIA_shift_reg")
    asm("LDA #$CC")
    asm("STA VIA_cntl")
    asm("CLR VIA_port_a")
    asm("LDA #$82")
    asm("STA VIA_port_b")
    asm("NOP")
    asm("NOP")
    asm("NOP")
    asm("NOP")
    asm("NOP")
    asm("LDA #$83")
    asm("STA VIA_port_b")
    asm("LDA #$EC")
    asm("STA VIA_port_a")
    asm("LDA #$CE")
    asm("STA VIA_cntl")
    asm("CLR VIA_port_b")
    asm("LDA #1")
    asm("STA VIA_port_b")
    asm("LDA #$EC")
    asm("STA VIA_port_a")
    asm("LDA #$7F")
    asm("STA VIA_t1_cnt_lo")
    asm("CLR VIA_t1_cnt_hi")
    asm("WAIT1:")
    asm("LDA VIA_int_flags")
    asm("ANDA #$40")
    asm("BEQ WAIT1")
    asm("LDA #40")
    asm("STA VIA_port_a")
    asm("CLR VIA_port_b")
    asm("LDA #1")
    asm("STA VIA_port_b")
    asm("CLR VIA_port_a")
    asm("CLR VIA_t1_cnt_hi")
    asm("LDA #$FF")
    asm("STA VIA_shift_reg")
    asm("WAIT2:")
    asm("LDA VIA_int_flags")
    asm("ANDA #$40")
    asm("BEQ WAIT2")
    asm("CLR VIA_shift_reg")
    asm("CLR VIA_port_a")
    asm("CLR VIA_port_b")
    asm("LDA #1")
    asm("STA VIA_port_b")
    asm("LDA #40")
    asm("STA VIA_port_a")
    asm("CLR VIA_t1_cnt_hi")
    asm("LDA #$FF")
    asm("STA VIA_shift_reg")
    asm("WAIT3:")
    asm("LDA VIA_int_flags")
    asm("ANDA #$40")
    asm("BEQ WAIT3")
    asm("CLR VIA_shift_reg")
    asm("LDA #$D8")
    asm("STA VIA_port_a")
    asm("CLR VIA_port_b")
    asm("LDA #1")
    asm("STA VIA_port_b")
    asm("CLR VIA_port_a")
    asm("CLR VIA_t1_cnt_hi")
    asm("LDA #$FF")
    asm("STA VIA_shift_reg")
    asm("WAIT4:")
    asm("LDA VIA_int_flags")
    asm("ANDA #$40")
    asm("BEQ WAIT4")
    asm("CLR VIA_shift_reg")
    asm("CLR VIA_port_a")
    asm("CLR VIA_port_b")
    asm("LDA #1")
    asm("STA VIA_port_b")
    asm("LDA #$D8")
    asm("STA VIA_port_a")
    asm("CLR VIA_t1_cnt_hi")
    asm("LDA #$FF")
    asm("STA VIA_shift_reg")
    asm("WAIT5:")
    asm("LDA VIA_int_flags")
    asm("ANDA #$40")
    asm("BEQ WAIT5")
    asm("CLR VIA_shift_reg")
